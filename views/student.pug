extends layout

block content
  h1 WÃ¤hle deinen Status:
  .buttons
    button(type='button', value='1', class='imageButton') 
      img(src="/img/forbidden.png", alt="Nicht interessiert", class="buttonImg")
      div(class="buttonDiv") Nicht interessiert

    button(type='button', value='2', class='imageButton') 
      img(src="/img/fast-forward.png", alt="Ich komme nicht hinterher", class="buttonImg")
      div(class="buttonDiv") Ich komme nicht hinterher

    button(type='button', value='3', class='imageButton') 
      img(src="/img/hourglass.png", alt="Ich langweile mich", class="buttonImg")
      div(class="buttonDiv") Ich langweile mich

    button(type='button', value='4', class='imageButton') 
      img(src="/img/info.png", alt="Ich verstehe das nicht", class="buttonImg")
      div(class="buttonDiv") Ich verstehe das nicht

    button(type='button', value='5', class='imageButton') 
      img(src="/img/like.png", alt="Alles bestens", class="buttonImg")
      div(class="buttonDiv") Alles bestens

  script.
    new Fingerprint2().get(function(result, components) {
      var object = {
        browserID: result
      }
      ajaxPost(window.location.pathname + '/getState', object, function(err, data){
        if(data){
          console.log('Current state is: ', data.state);
          $('button[value='+ data.state +']').css("border-color","lightblue");
          $('.buttons').show();
        } else {
          $('.buttons').show();
        }
      });
    });
    
    $('button').click(function(){
      $('button').css("border-color","");
      $(this).css("border-color","lightblue");
      var pathname = window.location.pathname;
      var selectedState = this.value;
      new Fingerprint2().get(function(result, components) {
        console.log('userID: ', result) // a hash, representing your device fingerprint
        var state = {
          state: selectedState,
          browserID: result
        }
        ajaxPost(pathname + '/addState', state, function(err, data){
          if(!err){
            console.log('State posted.');
          }
        });
      });
    });

    function ajaxPost(url, data, callback) {
      $.ajax({
          type: "POST",
          url: url,
          contentType: "application/json; charset = utf-8",
          datatype: "json",
          data: JSON.stringify(data),
          success: (data) => {
              callback(null, data)
          },
          error: (err) => {
              callback(err, null)
          }
      });
    }